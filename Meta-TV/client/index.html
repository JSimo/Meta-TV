<template name="slideshow">
	<div class="hoverinfo">
		<a href="#" class="fullscreen">Fullscreen</a><br>
		<a href="/slides">Add slides</a>
		<a href="/history">History</a>
	</div>
	{{#if equals current.type "html"}}
		{{{current.body}}}
	{{else}}
		{{#if equals current.type "markdown"}}
			<div class="down_marked_content">
				{{#markdown}}{{current.body}}{{/markdown}}
			</div>
			{{#if current.link}}
			<div class="content"> <img src="{{current.link}}"> </div>
			{{/if}}
		{{else}}
			<div class="content">
				{{#if equals current.type "youtube"}}
					<iframe width=100% height=100%
						src="//www.youtube.com/embed/{{current.link}}?autoplay=1&showinfo=0&controls=0"
						frameborder="0" allowfullscreen>
					</iframe>
				{{else}}
					<img src="{{current.link}}">
				{{/if}}
			</div>
		{{/if}}
	{{/if}}
</template>

<template name="slides">
	{{> loginButtons align="right"}}
	<div class="slides">
		<h1>Slides</h1>
		{{#each slides}}
			{{> slide}}
		{{/each}}
		{{#if currentUser}}
			<h1>Add</h1>
			<table>
				<tr>
					<td>Type</td>
					<td>
						<select class="type">
							<option value="external img">Link image</option>
							<option value="local img">Upload image</option>
							<option value="youtube">Youtube</option>
							<option value="markdown">Markdown</option>
							<option value="html">HTML</option>
						</select>
					</td>
				</tr>

				{{#if isHTML}}
					<tr>
						<td>HTML</td>
						<textarea class="html" cols="80" rows="10" ></textarea>
					</tr>
				{{else}}
					{{#if isMarkdown}}
						<tr>
							<td>Bg image url</td>
							<input class="link" type="text">
						</tr><tr>
							<td>Markdown</td>
							<textarea class="markdown" cols="80" rows="10" ></textarea>
						</tr>
					{{else}}
						{{#if isYoutube}}
							<tr>
								<td>Video id</td>
								<input class="link" type="text">
							</tr>
						{{else}}
							{{#if internal}}
								<tr>
									<td>File</td>
									<input class="file" type="file"/>
									<td class="error"> {{internal_filetype_error}} </td>
								</tr>
							{{else}}
								<tr>
									<td>Link</td>
									<td>
										<input class="link" type="text">
									</td>
									<td class="error">{{link_input_error}}</td>
								</tr>
							{{/if}}
						{{/if}}
					{{/if}}
				{{/if}}
				<tr>
					<td>Expire</td>
					<td>
						<input class="expire" type="date">
					</td>
				</tr>
				<tr>
					<td>Tags<br> (separated by white space)</td>
					<input class="tags" type="text" value="random">
				</tr>
				<tr>
					<td></td>
					<td>
						<button class="send">Send</button>
					</td>
				</tr>
			</table>
		{{/if}}
		<a href="/history">History</a>
		<div class="Policy">
			<h1>Policy</h1>
			<p>All KTH students can post there own slides and or remove others. Please no NSFW. Everythings is logged. I SEE YOU.</p>
		</div>
		{{> footer}}
	</div>
</template>

<template name="footer">
	<footer>
		Created by <a href="http://sootn.se">Andreas Linn</a>
	</footer>
</template>

<template name="slide">
	<article>
		{{#if equals type "youtube"}}
			<img src="http://img.youtube.com/vi/{{link}}/0.jpg">
		{{else}}
			<img src="{{link}}">
		{{/if}}
		<table>
			<tr>
				<td>id</td>
				<td>{{_id}}</td>
				<td rowspan="10000000">
					{{#if canhazedit}}
						<textarea class="update_markdown" cols="30" rows="10" >{{body}}</textarea>
						<button class="update">Update</button>
					{{else}}
						{{#if equals type "html"}}
							<div style="max-width:300px;height:200px;overflow: hidden;">
								{{{body}}}
							</div>
						{{else}}
							{{#if equals type "markdown"}}
								<div style="max-width:300px;height:200px;overflow: hidden;">
									{{#markdown}}{{body}}{{/markdown}}
								</div>
							{{/if}}
						{{/if}}
					{{/if}}
				</td>
			</tr>
			<tr>
				<td>Type</td>
				<td>{{type}}</td>
			</tr>
			<tr>
				<td>Expire</td>
				<td>
					<date>{{#if expire}} {{expire}} {{else}} Never {{/if}}</date>
				</td>
			</tr>
			<tr>
				<td>Created by</td>
				<td>
					<date>{{createdBy}}</date>
				</td>
			</tr>
			<tr>
				<td>Actions</td>
				<td>
					<button class="remove">Remove</button>
					{{#if equals type "markdown"}}
						<button class="edit">Eddit</button>
					{{/if}}
					{{#if equals type "html"}}
						<button class="edit">Eddit</button>
					{{/if}}
				</td>
			</tr>
			<tr>
				<td>Tags:</td>
				<td>
					<!-- this is cousing some kind of error,
							Exception in queued task: badSequenceError
							see console.log -->
					{{#each tags}}
					{{this}},
					{{/each}}
				</td>
			</tr>
		</table>
	</article>
	<hr>
</template>

<template name="history">
<div style="padding:0em;">
<h1>History</h1>
{{{test_html}}}
{{#each log}}
<article>
	<table style="float:left;">
		<tr>
			<td colspan="2">
				<b>{{action}}</b> by <i>{{by}}</i>
			</td>
		</tr>
		<tr>
			<td>
				time:
			</td>
			<td>
				{{time}}
			</td>
		</tr>
	</table>
	<table style="margin-left:20em;">
		{{#each members obj}}
			<tr>
				<td style="color:gray;">{{key}}</td>
				<td style="padding-left:10px;">{{value}}</td>
			</tr>
		{{/each}}
	</table>
	<button class="revert" style="align:right;">Revert</button>
</article>
<hr>
{{/each}}
</div>
</template>
